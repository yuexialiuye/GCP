# 第十三周
## 使用遠端方式用SQL
````
打開cloud shell
gcloud sql databases create testdb --instance=mydb, -i mydb
gcloud sql connect mydb --user=root
密碼admin1234
use testdb;
CREATE TABLE info (
id INT NOT NULL AUTO_INCREMENT,
firstname VARCHAR(20),
lastname VARCHAR(20),
age VARCHAR(3),
collegename VARCHAR(150),
PRIMARY KEY (id)
);
另開一個cloud shell，
mkdir cf_mysql
cd cf_mysql
sudo vim main.py
貼上

import sqlalchemy
#connection name we noted earlier
connection_name = "mygcp-436602:us-central1:mydb"
#database name
db_name = "testdb"
db_user = "root"
db_password = "admin1234"
driver_name = 'mysql+pymysql'
query_string = dict({"unix_socket": "/cloudsql/{}".format(connection_name)})

def writeToSql(request):
   #You can change this to match your personal details
   stmt = sqlalchemy.text("INSERT INTO info ( firstname, lastname, age, collegename) values ('Sagadevan', 'Kounder', '21', 'XYZ College')")

   db = sqlalchemy.create_engine(
   sqlalchemy.engine.url.URL(
   drivername=driver_name,
   username=db_user,
   password=db_password,
   database=db_name,
   query=query_string,
   ),
   pool_size=5,
   max_overflow=2,
   pool_timeout=30,
   pool_recycle=1800
   )
   try:
      with db.connect() as conn:
        conn.execute(stmt)
        print("Insert successful")
   except Exception as e:
      print ("Some exception occured" + e)
      return 'Error: {}'.format(str(e))
   return 'ok'

esc
:wq
記得更改專案名稱
````

````
sudo vim requirements.txt
貼上
SQLAlchemy==1.3.12
PYMYSQL==0.9.3

:wq儲存

gcloud functions deploy writeToSql --entry-point writeToSql --runtime python310 --trigger-http --allow-unauthenticated  --no-gen2 --source .
到funtion run頁面即可看到部屬好的程式
````
